<UserControl x:Class="PTRP.App.Views.Educators.EducatorListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1200">
    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <materialDesign:Card Grid.Column="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="{DynamicResource PrimaryHueMidBrush}" Padding="16">
                    <TextBlock Text="Lista Educatori" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Foreground="White"/>
                </Border>

                <StackPanel Grid.Row="1" Margin="16">
                    <TextBox materialDesign:HintAssist.Hint="ðŸ” Cerca per nome o cognome"
                             Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,0,8" />
                </StackPanel>

                <DataGrid Grid.Row="2"
                          ItemsSource="{Binding Educators}"
                          SelectedItem="{Binding SelectedEducator}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeRows="False"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          Margin="16,0,16,16">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Cognome" Binding="{Binding LastName}" Width="*"/>
                        <DataGridTextColumn Header="Nome" Binding="{Binding FirstName}" Width="*"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="2*"/>
                        <DataGridTextColumn Header="Pazienti" Binding="{Binding AssignedPatientsCount}" Width="Auto"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </materialDesign:Card>

        <materialDesign:Card Grid.Column="2" Visibility="{Binding SelectedEducator, Converter={StaticResource NullToVisibilityConverter}}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="16">
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="{Binding SelectedEducator.FullName}" Style="{StaticResource MaterialDesignHeadline5TextBlock}" TextWrapping="Wrap"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button ToolTip="Modifica" Style="{StaticResource MaterialDesignIconButton}" Margin="0,0,4,0">
                                <materialDesign:PackIcon Kind="Pencil" Width="20" Height="20"/>
                            </Button>
                            <Button ToolTip="Disattiva" Style="{StaticResource MaterialDesignIconButton}">
                                <materialDesign:PackIcon Kind="AccountOff" Width="20" Height="20"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                    
                    <TextBlock Text="Anagrafica" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                    <Border Background="{DynamicResource MaterialDesignDivider}" CornerRadius="4" Padding="12" Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                <TextBlock Text="Email: " FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding SelectedEducator.Email}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                <TextBlock Text="Telefono: " FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding SelectedEducator.Phone}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Data assunzione: " FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding SelectedEducator.HireDate, StringFormat=dd/MM/yyyy}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <TextBlock Text="Statistiche Mese Corrente" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                    <Border Background="{DynamicResource MaterialDesignDivider}" CornerRadius="4" Padding="12" Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                <materialDesign:PackIcon Kind="FileDocument" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Visite registrate: " FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding SelectedEducator.TotalVisitsThisMonth}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="CalendarClock" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Appuntamenti programmati: " FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding SelectedEducator.ScheduledAppointments}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <TextBlock Text="Pazienti Assegnati" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                    <ItemsControl ItemsSource="{Binding SelectedEducator.AssignedPatients}" Margin="0,0,0,16">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource MaterialDesignDivider}" CornerRadius="4" Padding="12" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="{Binding PatientFullName}" FontWeight="SemiBold" FontSize="14"/>
                                        <TextBlock Text="{Binding ProjectTitle}" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,4,0,0"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0" Visibility="{Binding NextAppointmentDate, Converter={StaticResource NullToVisibilityConverter}}">
                                            <materialDesign:PackIcon Kind="CalendarClock" Width="14" Height="14" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryHueMidBrush}" Margin="0,0,6,0"/>
                                            <TextBlock Text="{Binding NextAppointmentDisplay}" FontSize="12" Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <StackPanel>
                        <Button Style="{StaticResource MaterialDesignRaisedButton}" HorizontalAlignment="Stretch" Margin="0,0,0,8">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Calendar" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Visualizza Calendario"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}" HorizontalAlignment="Stretch">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="AccountPlus" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="Assegna Paziente"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </materialDesign:Card>
    </Grid>
</UserControl>
